<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard Financiero</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
  <!-- Chart.js para gr√°ficos -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
  <!-- ======= Auth Gate ======= -->
  <div id="auth" class="auth">
    <div class="auth__card">
      <h2>Ingresa tu clave</h2>
      <input id="authPass" type="password" placeholder="Clave" />
      <button id="authBtn">Entrar</button>
      <small class="muted">Se recuerda por 24 horas en este navegador.</small>
      <div id="authMsg" class="auth__msg"></div>
    </div>
  </div>

  <div class="wrap" id="app" style="display:none">
    <header>
      <h1>Dashboard Financiero</h1>
      <small>Proyectos + distribuci√≥n de pagos</small>
    </header>

    <!-- KPIs -->
    <section class="card">
      <div class="grid kpis">
        <div class="kpi"><span class="kpi__t">Ventas Totales</span><span id="kpiVentas" class="kpi__v">$0</span></div>
        <div class="kpi"><span class="kpi__t">Monto Pagado</span><span id="kpiCobrado" class="kpi__v">$0</span></div>
        <div class="kpi"><span class="kpi__t">Saldo por Cobrar</span><span id="kpiSaldo" class="kpi__v">$0</span></div>
      </div>
    </section>

    <!-- Formulario Crear/Editar proyecto -->
    <section class="card">
<h2>Nuevo / Editar proyecto</h2>
<form id="f">
  <div class="form-grid">
    <div>
      <label>Fecha</label>
      <input type="date" name="fecha">
    </div>
    <div>
      <label>Cliente</label>
      <input type="text" name="cliente" placeholder="Cliente">
    </div>
    <div>
      <label>Proyecto</label>
      <input type="text" name="proyecto" placeholder="Proyecto">
    </div>
  </div>

  <div class="form-grid">
    <div>
      <label>Monto (CLP)</label>
      <input type="number" name="monto" placeholder="Monto">
    </div>
    <div>
      <label>Estado</label>
      <select name="estado">
        <option>En curso</option>
        <option>Aprobado</option>
        <option>Pausado</option>
        <option>Finalizado</option>
        <option>Cancelado</option>
        <option>Facturado</option>
        <option>Pagado parcial</option>
        <option>Pagado</option>
      </select>
    </div>
  </div>

  <div class="form-grid">
    <div>
      <label>Vendedor</label>
      <input type="text" name="vendedor" placeholder="Vendedor">
    </div>
    <div>
      <label>Director</label>
      <input type="text" name="director" placeholder="Director">
    </div>
    <div>
      <label>Consultor</label>
      <input type="text" name="consultor" placeholder="Consultor">
    </div>
  </div>

  <div class="form-grid">
    <div>
      <label>Administraci√≥n (responsable)</label>
      <input type="text" name="administracion" placeholder="Nombre responsable de administraci√≥n">
    </div>
    <div>
      <label>Gasto (responsable)</label>
      <input type="text" name="gasto" placeholder="Nombre a cargo de gastos">
    </div>
    <div>
      <label>Fee Consultora (responsable)</label>
      <input type="text" name="fee_consultora" placeholder="Responsable Fee Consultora">
    </div>
  </div>

  <div class="buttons">
    <button type="submit">Guardar</button>
    <button type="button" id="btnReset" class="btn-secondary">Limpiar</button>
  </div>
</form>


        <!-- Campos condicionales de pago -->
        <div id="pagoFields" class="grid" style="display:none">
          <label id="grpPorcPagado">% pagado
            <input name="porc_cobrado" id="porc_pagado" type="number" step="1" min="0" max="100" placeholder="0‚Äì100">
          </label>
          <label id="grpMontoPagado">Monto pagado (CLP)
            <input id="monto_pagado" type="number" step="1" placeholder="Ej: 3000000">
          </label>
          <label id="grpFechaEstimada">Fecha estimada de pago
            <input name="fecha_estimada_pago" id="fecha_estimada_pago" type="date">
          </label>
          <label id="grpFechaPago" style="display:none">Fecha de pago
            <input name="fecha_pago" id="fecha_pago" type="date">
          </label>
        </div>

        <div class="row">
          <button type="submit">Guardar</button>
          <button type="button" id="btnReset" class="ghost">Limpiar</button>
        </div>
      </form>
    </section>

    <!-- Rendici√≥n de gastos -->
    <section class="card">
      <div class="row space">
        <h3>Rendici√≥n gastos</h3>
        <div id="boxDisponible" class="pill"></div>
      </div>
      <form id="fgasto">
        <div class="grid">
          <label>Fecha gasto<input id="g_fecha" type="date" required></label>
          <label>Monto (CLP)<input id="g_monto" type="number" step="1" min="0" required></label>
          <label>Cliente
            <select id="g_cliente" required></select>
          </label>
          <label>Proyecto
            <select id="g_proyecto" required></select>
          </label>
        </div>
        <div class="row">
          <button type="submit">Registrar gasto</button>
          <button type="button" id="g_reset" class="ghost">Limpiar</button>
        </div>
      </form>
    </section>

    <!-- Reglas editables -->
    <section class="card">
      <h3>Reglas de distribuci√≥n (editable)</h3>
      <div class="grid" id="rulesForm">
        <label>Vendedor (%)<input type="number" step="0.1" min="0" max="100" id="rule_vendedor"></label>
        <label>Director (%)<input type="number" step="0.1" min="0" max="100" id="rule_director"></label>
        <label>Consultor (%)<input type="number" step="0.1" min="0" max="100" id="rule_consultor"></label>
        <label>Gasto (%)<input type="number" step="0.1" min="0" max="100" id="rule_gasto"></label>
        <label>Administraci√≥n (%)<input type="number" step="0.1" min="0" max="100" id="rule_admin"></label>
        <label>Fee Consultora (%)<input type="number" step="0.1" min="0" max="100" id="rule_fee"></label>
      </div>
      <div class="row" style="margin-top:8px">
        <span id="rulesTotal" class="badge">Total: 0%</span>
        <button type="button" id="saveRules">Guardar reglas</button>
        <button type="button" id="resetRules" class="ghost">Reset a 15/18/50/3/4/10</button>
      </div>
      <small class="muted">Se aplican sobre el <strong>monto pagado</strong>.</small>
    </section>

    <!-- Tabla proyectos -->
    <section class="card">
      <div class="row space">
        <h3>Proyectos</h3>
        <div class="row">
          <input id="q" placeholder="üîé Buscar cliente/proyecto" />
          <select id="fEstado">
            <option value="">Todos los estados</option>
            <option>Prospecto</option>
            <option>Propuesta</option>
            <option>Aprobado</option>
            <option>En curso</option>
            <option>Pausado</option>
            <option>Finalizado</option>
            <option>Facturado</option>
            <option>Pagado parcial</option>
            <option>Pagado</option>
            <option>Cancelado</option>
          </select>
        </div>
      </div>
      <div class="scroll">
        <table id="tbl">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Cliente</th>
              <th>Proyecto</th>
              <th class="r">Monto</th>
              <th class="r">% Pagado</th>
              <th class="r">Pagado</th>
              <th>Vendedor</th>
              <th>Director</th>
              <th>Consultor</th>
              <th>Administraci√≥n</th>
              <th>Gasto</th>
              <th>Fee Consultora</th>
              <th>Estado</th>
              <th></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- Gr√°ficos -->
    <section class="card">
      <h3>Gr√°ficos de distribuci√≥n</h3>
      <div class="grid charts">
        <div class="chartBox">
          <h4>Torta por rol</h4>
          <canvas id="chartRoles"></canvas>
        </div>
        <div class="chartBox">
          <h4>Torta por persona/organizaci√≥n</h4>
          <canvas id="chartPersonas"></canvas>
        </div>
      </div>
    </section>

    <!-- Totales por rol -->
    <section class="card">
      <h3>Totales por rol (sobre monto pagado)</h3>
      <div class="scroll">
        <table id="tblRoles">
          <thead><tr><th>Rol</th><th class="r">Monto</th></tr></thead>
          <tbody></tbody>
          <tfoot><tr><th>Total</th><th class="r" id="ttlRoles">$0</th></tr></tfoot>
        </table>
      </div>
    </section>

    <!-- Liquidaci√≥n por persona -->
    <section class="card">
      <h3>Liquidaci√≥n por persona (todos los roles)</h3>
      <div class="scroll">
        <table id="tblPersonas">
          <thead><tr><th>Persona/Organizaci√≥n</th><th>Rol</th><th class="r">Monto</th><th class="r"># Proyectos</th></tr></thead>
          <tbody></tbody>
          <tfoot><tr><th colspan="2">Total</th><th class="r" id="ttlPersonas">$0</th><th></th></tr></tfoot>
        </table>
      </div>
    </section>

    <!-- Resumen distribuci√≥n -->
    <section class="card">
      <h3>Distribuci√≥n (sobre monto pagado)</h3>
      <div id="resumen"></div>
    </section>
  </div>

  <script src="app.js"></script>
</body>
</html>
